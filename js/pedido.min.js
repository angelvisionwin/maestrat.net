"use strict";function inicializa_totales(){oTotales.usuariosnube.gestion=1,oTotales.usuariosnube.contabilidad=1,oTotales.soporte.gestionlocal=0,oTotales.soporte.contabilidadlocal=0,oTotales.soporte.gestionnube=0,oTotales.soporte.contabilidadnube=0,oTotales.soporte.copias=0,oTotales.pedido.periodicidad=1,oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,oTotales.pedido.ivafijo=21,$("#rangogestionnube").val(1),$("#rangogestionnube").change(),$("#rangocontabilidadnube").val(1),$("#rangocontabilidadnube").change(),$("#codigocupon").val(""),$("#formcopias").prop("checked",!1),$.each(oTotales.soporte,function(o,e){$('select[id="select'+o+'"]').val(0),muestra_opciones_producto(o)})}function muestra_opciones_producto(o){var e,a=$('select[id="select'+o+'"]').val(),t=0;e=opciones_actualiza_sino(a,o),opciones_carga_html(e,o),opciones_colapsa(o,a),t=calcula_cuota(o,a),pinta_cuota(o,t),colapsa_cuota(o,t,a),usuarios_selectores(o,a),actualiza_resumen_pedido(t),calcula_totales_pedido(),pinta_totales_pedido()}function opciones_actualiza_sino(o,e){var a=["no","no","no","no","no","no","no"];switch(o){case"0":break;case"1":a[0]="si";break;case"2":a[0]="si",a[1]="si",a[4]="si",a[5]="si",a[6]="si";break;case"3":a[0]="si",a[1]="si",a[2]="si",a[3]="si",a[4]="si",a[5]="si",a[6]="si"}return a}function opciones_carga_html(o,e){var a="",t=0;a="<div class='col-md h5'>",a+="El soporte que has seleccionado incluye :",a+="</div>",a+="<div class='row p-2'>",$.each(o,function(o,e){0!=t&&4!=t||(a+="<div class='sino col-md-4 bg-white'>"),a+="<p><i class='fa ",a+="no"===e?"fa-times":"fa-check",a+=" pr-2' style='width:24px;' title='No' alt='No'></i>",a+=anombres[o]+"</p>",t++,4==t&&(a+="</div>")}),a+="</div>",a+="</div>",$("#opcionesregistro"+e).html(a)}function opciones_colapsa(o,e,a){e>0&&!a?$("#opcionesregistro"+o).collapse("show"):$("#opcionesregistro"+o).collapse("hide")}function calcula_cuota(o,e){var a=0;return a=oPrecios[o][e],0!=a&&"gestionnube"===o&&(a+=oPrecios.usuarioextra*(oTotales.usuariosnube.gestion-1)),0!=a&&"contabilidadnube"===o&&(a+=oPrecios.usuarioextra*(oTotales.usuariosnube.contabilidad-1)),isNaN(a)&&(a=0),a}function pinta_cuota(o,e){"gestionlocal"===o||"contabilidadlocal"===o?$("#cuotaregistro"+o).html("Cuota anual : "+e+"€"):($("#precioanualregistro"+o).html(e),$("#preciomensualregistro"+o).html(e/10))}function colapsa_cuota(o,e,a){0===e?($("#cuotaregistro"+o).collapse("hide"),oTotales.soporte[o]=0):($("#cuotaregistro"+o).collapse("show"),oTotales.soporte[o]=a)}function usuarios_selectores(o,e){"gestionnube"!==o&&"contabilidadnube"!=o||(e>0?$("#selectorusuarios"+o).collapse("show"):$("#selectorusuarios"+o).collapse("hide"))}function pedido_mirarangos(o){let e,a,t,i=$("#"+o).val();switch(o){case"rangogestionnube":e="usuariosgestionnube",oTotales.usuariosnube.gestion=i;break;case"rangocontabilidadnube":e="usuarioscontabilidadnube",oTotales.usuariosnube.contabilidad=i}$("#"+e).text(i),a=o.slice(5,99),t=$('select[id="select'+a+'"]').val(),pinta_cuota(a,calcula_cuota(a,t)),actualiza_resumen_pedido(),calcula_totales_pedido(),pinta_totales_pedido()}function actualiza_resumen_pedido(){var o="",e="",a=0;0!=oTotales.soporte.gestionlocal&&(o+="<p><b>1 x Visionwin Gestion (instalación local)</b><br>",o+=" - "+asoportes[oTotales.soporte.gestionlocal-1]+"<br>",o+="</p>",e+="<p>"+oPrecios.gestionlocal[oTotales.soporte.gestionlocal]+"€ al año<br/><br/></p>"),0!=oTotales.soporte.contabilidadlocal&&(o+="<p><b>1 x Visionwin Contabilidad (instalación local)</b><br>",o+=" - "+asoportes[oTotales.soporte.contabilidadlocal-1]+"<br>",o+="</p>",e+="<p>"+oPrecios.contabilidadlocal[oTotales.soporte.contabilidadlocal]+"€ al año<br/><br/></p>"),1==oTotales.soporte.copias&&(o+="<p><b>1 x Copias en servidor seguro</b><br>",o+="</p>",e+="<p>"+oPrecios.copias[1]+"€ al año<br/><br/></p>"),0!=oTotales.soporte.gestionnube&&(o+="<p><b>1 x Visionwin Gestion (en la nube)</b><br>",o+=" - "+asoportes[oTotales.soporte.gestionnube-1]+" : "+oTotales.usuariosnube.gestion+" Usuarios<br>",o+="</p>",a=calcula_cuota("gestionnube",oTotales.soporte.gestionnube),1===oTotales.pedido.periodicidad?e+="<p>"+a+"€ al año<br/><small>¡Ahorra dos meses!</small><br/>":e+=a/10+"€ al mes<br/><br/></p>"),0!=oTotales.soporte.contabilidadnube&&(o+="<p><b>1 x Visionwin Contabilidad (en la nube)</b><br>",o+=" - "+asoportes[oTotales.soporte.contabilidadnube-1]+" : "+oTotales.usuariosnube.contabilidad+" Usuarios<br>",o+="</p>",a=calcula_cuota("contabilidadnube",oTotales.soporte.contabilidadnube),1===oTotales.pedido.periodicidad?e+="<p>"+a+"€ al año<br/><small>¡Ahorra dos meses!</small><br/>":e+=a/10+"€ al mes<br/></p>"),$("#resumenpedidotexto").html(o),$("#resumenpedidoprecio").html(e),$("#resumenfinalpedidotexto").html(o),$("#resumenfinalpedidoprecio").html(e)}function revisapagomensual(){$("#pagomensual").is(":checked")?(oTotales.pedido.periodicidad=10,oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,$("#tarjeta").attr("disabled",!0),$("#paypal").attr("disabled",!0),$("#transferencia").attr("disabled",!0),$("#tarjeta").attr("checked",!1),$("#paypal").attr("checked",!1),$("#transferencia").attr("checked",!1),$("#recibo").click()):(oTotales.pedido.periodicidad=1,$("#tarjeta").attr("disabled",!1),$("#paypal").attr("disabled",!1),$("#transferencia").attr("disabled",!1)),actualiza_resumen_pedido(),calcula_totales_pedido(),pinta_totales_pedido()}function revisaivaexento(){$("#formivaexento").is(":checked")?(oTotales.pedido.ivapor=0,oTotales.pedido.exento="si"):(oTotales.pedido.ivapor=oTotales.pedido.ivafijo,oTotales.pedido.exento="no"),calcula_totales_pedido(),pinta_totales_pedido()}function revisacopias(){$("#formcopias").is(":checked")?oTotales.soporte.copias=1:oTotales.soporte.copias=0,actualiza_resumen_pedido(),calcula_totales_pedido(),pinta_totales_pedido()}function calcula_totales_pedido(){oTotales.pedido.bruto=0,$.each(oTotales.soporte,function(o,e){oTotales.pedido.bruto+=calcula_cuota(o,e)}),oTotales.pedido.bruto=round(oTotales.pedido.bruto/oTotales.pedido.periodicidad,2),oTotales.pedido.descuento=oTotales.pedido.cupondescuento,oTotales.pedido.base=oTotales.pedido.bruto-oTotales.pedido.descuento,oTotales.pedido.ivaimp=round(oTotales.pedido.base*oTotales.pedido.ivapor/100,2),oTotales.pedido.total=round(oTotales.pedido.base+oTotales.pedido.ivaimp,2),"paypal"===oTotales.pedido.formapago?(oTotales.pedido.recargo=round(oTotales.pedido.total/.966+.35,2)-oTotales.pedido.total,oTotales.pedido.total+=oTotales.pedido.recargo):oTotales.pedido.recargo=0}function pinta_totales_pedido(){var o="",e="";$("#formbruto").val(number_format(oTotales.pedido.bruto,2)+"€"),$("#formdescuento").val(oTotales.pedido.descuento+"€"),$("#formbase").val(number_format(oTotales.pedido.base,2)+"€"),$("#formivapor").val(oTotales.pedido.ivapor+"%"),$("#formivaimp").val(number_format(oTotales.pedido.ivaimp,2)+"€"),$("#formrecargo").val(number_format(oTotales.pedido.recargo,2)+"€"),$("#formtotal").val(number_format(oTotales.pedido.total,2)+"€"),o+="Importe bruto : <br/>",e+=number_format(oTotales.pedido.bruto,2)+"€<br/>",0!=oTotales.pedido.descuento&&(o+="Descuentos aplicados :<br/>",e+=oTotales.pedido.descuento+"€<br/>"),o+="Base imponible :<br/>",e+=number_format(oTotales.pedido.base,2)+"€<br/>",o+="Iva ("+oTotales.pedido.ivapor+"%) :<br/>",e+=number_format(oTotales.pedido.ivaimp,2)+"€<br/>",0!=oTotales.pedido.recargo&&(o+="Subtotal antes de recargo : <br/>",e+=number_format(oTotales.pedido.base+oTotales.pedido.ivaimp,2)+"€<br/>",o+="Recargo Paypal :<br/>",e+=number_format(oTotales.pedido.recargo,2)+"€<br/>"),o+="<b>TOTAL PEDIDO : </b><br/>",e+="<b>"+number_format(oTotales.pedido.total,2)+"€</b><br/>",o+="Forma de pago : ",e+=oTotales.pedido.formapago,$("#resumenfinaltotalestextos").html(o),$("#resumenfinaltotalesimportes").html(e)}function pedidoAplicaCupon(){var o=$("#codigocupon").val().toUpperCase();return"OFERTA15"!=o?($("#modalNoCuponBody").html("Cupón inválido"),$("#modalNoCupon").modal("show"),oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,!1):0===oTotales.pedido.bruto?($("#modalNoCuponBody").html("No es posible aplicar un cupón de descuento a un pedido vacío"),$("#modalNoCupon").modal("show"),oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,!1):1!=oTotales.pedido.periodicidad?($("#modalNoCuponBody").html("En la modalidad de pago mensual no se puede aplicar este cupón de descuento"),$("#modalNoCupon").modal("show"),oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,!1):0!=oTotales.soporte.copias&&oTotales.pedido.total<100?($("#modalNoCuponBody").html("No se pueden aplicar cupones a las copias de seguridad"),$("#modalNoCupon").modal("show"),oTotales.pedido.cuponnombre="",oTotales.pedido.cupondescuento=0,!1):("OFERTA15"===o.toUpperCase()&&(oTotales.pedido.cuponnombre="OFERTA15",oTotales.pedido.cupondescuento=15),calcula_totales_pedido(),void pinta_totales_pedido())}function clickformadepago(o){pedidoOcultaIBAN(),$("#pistatarjeta").hide(),$("#pistapaypal").hide(),$("#pistatransferencia").hide(),$("#pistarecibo").hide(),$("#pista"+o).show(),"recibo"===o&&pedidoMuestraIBAN(),oTotales.pedido.formapago=o,calcula_totales_pedido(),pinta_totales_pedido()}function finalizarPedido(){var o,e;e=form2json("formulariopedidonuevo"),e.totales=oTotales,$("#modalResumenPedido").modal("hide"),o="php/procesapedido.php",$.ajax({url:o,type:"POST",data:JSON.stringify(e),contentType:"application/json",success:function(o){$("#pedidograbadotexto").html(o)}}),$("#contenedorformulario").hide(),$("#pedidograbado").collapse("show"),$("#pedidograbadopagopor"+oTotales.pedido.formapago).collapse("show"),window.scrollTo(0,0)}function nuevopedidoPagarPaypal(){var o,e,a;o=document.getElementById("pedidograbadotexto").innerHTML,o=trim(o.substr(30,6)),a="php/pagopaypal.php",e={pedido:o,token:"9987jazzkdklr_"},$.ajax({type:"POST",url:a,data:e,success:function(o){document.getElementById("pedidograbadopagoporpaypal").innerHTML=o,$("#modalProcesandoPago").modal("show"),$("#botonenviaformulariopaypal").click()}})}function nuevopedidoPagarTarjeta(){var o,e,a;o=document.getElementById("pedidograbadotexto").innerHTML,o=trim(o.substr(30,6)),a="php/pagotarjeta.php",e={pedido:o,token:"9987jazzkdklr_"},$.ajax({type:"POST",url:a,data:e,success:function(o){document.getElementById("pedidograbadopagoportarjeta").innerHTML=o,$("#modalProcesandoPago").modal("show"),$("#botonenviaformulariotarjeta").click()}})}function pedidoPonControlIBAN(){var o=document.getElementById("IBAN");o.addEventListener("keyup",function(e){1==validaIBAN(o.value)?o.setCustomValidity(""):o.setCustomValidity("Por favor, introduzca un IBAN válido sin espacios")})}function pedidoPonControlNIF(){var o=document.getElementById("NIF");o.addEventListener("keyup",function(e){1==CIFCorrecto(o.value)||1==DNICorrecto(o.value)?o.setCustomValidity(""):o.setCustomValidity("Por favor, introduzca un DNI o NIF válido")})}function pedidoMuestraIBAN(){$("#textoiban").collapse("show"),$("#IBAN").prop("required",!0)}function pedidoOcultaIBAN(){$("#textoiban").collapse("hide"),$("#IBAN").prop("required",!1)}var oTotales={usuariosnube:{gestion:1,contabilidad:1},soporte:{gestionlocal:0,contabilidadlocal:0,gestionnube:0,contabilidadnube:0,copias:0},pedido:{formapago:"tarjeta",periodicidad:1,bruto:0,descuento:0,recargo:0,base:0,ivapor:21,ivaimp:0,exento:"no",total:0,cuponnombre:"",cupondescuento:0,ivafijo:21}},asoportes=["Servicio de actualizaciones","Soporte básico","Soporte profesional"],anombres=["Actualizaciones del programa","Consultas por correo y chat","Soporte telefónico","Conexión remota con los técnicos","Acceso al portal de usuarios","Acceso a la base de conocimientos","Acceso al sistema de tickets personalizado"];